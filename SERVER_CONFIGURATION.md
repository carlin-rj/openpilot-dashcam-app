# 服务器配置功能说明

## 概述

Flutter 客户端提供了灵活的服务器配置功能，支持多种连接方式，适应不同的网络环境和使用场景。

## 🔧 配置方式

### 1. 手动输入服务器地址

**位置**: 设置页面 > 服务器设置 > 服务器地址

**支持格式**:
- `http://localhost:8009` - 本地服务器
- `http://192.168.1.100:8009` - 局域网服务器
- `http://example.com:8009` - 远程服务器
- `https://secure.example.com:8009` - HTTPS 服务器

**功能特性**:
- 实时连接测试
- 自动保存到历史记录
- 支持清除和重新输入

### 2. 自动服务器发现

**功能**: 自动扫描局域网中的 dashcam 服务器

**扫描范围**:
- 常用端口: 8009, 8080, 3000, 8000, 5000
- IP 范围: 当前网段的所有 IP (1-254)
- 超时时间: 3 秒

**使用方法**:
1. 点击"搜索服务器"按钮
2. 等待扫描完成
3. 从发现的服务器列表中选择
4. 点击"使用"按钮连接

### 3. 服务器预设

**内置预设**:
- 本地服务器 (http://localhost:8009)
- 本地服务器 8080 端口 (http://localhost:8080)
- 本地服务器 3000 端口 (http://localhost:3000)
- 局域网示例 (http://192.168.1.100:8009)

**使用方法**:
- 点击预设标签快速填入地址
- 自动进行连接测试

### 4. 历史记录

**功能**: 保存最近使用的 10 个服务器地址

**操作**:
- 自动保存成功连接的地址
- 支持快速选择历史地址
- 支持删除单个历史记录
- 支持清除所有历史记录

### 5. 快速连接对话框

**触发方式**:
- 主界面连接状态栏的"快速连接"按钮
- 连接失败时的快速重连

**功能**:
- 手动输入 + 自动发现的组合界面
- 实时连接状态显示
- 一键连接功能

## ⚙️ 高级设置

### 连接超时设置

**可选值**: 5秒, 10秒, 15秒, 30秒, 60秒
**默认值**: 10秒
**影响范围**: 所有 API 请求的超时时间

### 服务器信息显示

**显示内容**:
- 服务器地址
- 连接状态 (成功/失败/未知)
- 总路线数
- 总视频段数
- 可用摄像头列表

## 🌐 网络环境适配

### 本地开发环境

```
服务器地址: http://localhost:8009
适用场景: 开发测试
配置方式: 使用预设或手动输入
```

### 局域网环境

```
服务器地址: http://192.168.x.x:8009
适用场景: 家庭/办公室网络
配置方式: 自动发现 + 手动确认
```

### 远程访问

```
服务器地址: http://your-domain.com:8009
适用场景: 远程访问
配置方式: 手动输入 + 连接测试
注意事项: 确保防火墙和端口转发配置正确
```

### HTTPS 安全连接

```
服务器地址: https://secure.example.com:8009
适用场景: 生产环境
配置方式: 手动输入
注意事项: 需要有效的 SSL 证书
```

## 🔍 故障排除

### 连接失败

**可能原因**:
1. 服务器未启动
2. 网络不通
3. 端口被占用或防火墙阻止
4. 地址输入错误

**解决方法**:
1. 检查服务器是否正在运行
2. 使用自动发现功能扫描网络
3. 尝试不同的端口
4. 检查防火墙设置

### 自动发现无结果

**可能原因**:
1. 服务器不在同一网段
2. 服务器使用非标准端口
3. 网络安全策略限制

**解决方法**:
1. 手动输入服务器地址
2. 检查网络连接
3. 联系网络管理员

### 连接超时

**可能原因**:
1. 网络延迟较高
2. 服务器响应慢
3. 超时设置过短

**解决方法**:
1. 增加连接超时时间
2. 检查网络质量
3. 优化服务器性能

## 📱 平台差异

### 桌面平台 (Windows/macOS)

- 支持所有功能
- 网络扫描性能较好
- 支持复杂的网络配置

### 移动平台 (Android/iOS)

- 支持所有功能
- 网络扫描可能受系统限制
- 需要网络权限

## 🔐 安全考虑

### 网络安全

- 支持 HTTPS 连接
- 不存储敏感信息
- 连接状态实时验证

### 隐私保护

- 历史记录仅本地存储
- 不上传服务器信息
- 支持清除所有数据

## 💡 使用建议

### 首次使用

1. 启动应用后，先使用自动发现功能
2. 如果发现服务器，直接选择使用
3. 如果未发现，手动输入服务器地址
4. 测试连接成功后，地址会自动保存

### 日常使用

1. 应用会记住上次的服务器地址
2. 如果连接失败，使用快速连接功能
3. 定期清理历史记录保持整洁

### 多环境切换

1. 使用历史记录快速切换
2. 为不同环境设置不同的超时时间
3. 利用预设功能快速访问常用服务器

---

通过这些灵活的配置选项，Flutter 客户端可以适应各种网络环境和使用场景，为用户提供便捷的服务器连接体验。
